  pub(crate) fn process_alert(&mut self, alert: &AlertMessagePayload) -> Result<(), Error> {

        

        if let AlertLevel::Unknown(_) = alert.level {

            return Err(self.send_fatal_alert(

                AlertDescription::IllegalParameter,

                Error::AlertReceived(alert.description),

            ));

        }



        

        

        if self.may_receive_application_data && alert.description == AlertDescription::CloseNotify {

            self.has_received_close_notify = true;

            return Ok(());

        }



        

        

        let err = Error::AlertReceived(alert.description);

        if alert.level == AlertLevel::Warning {

            if self.is_tls13() && alert.description != AlertDescription::UserCanceled {

                return Err(self.send_fatal_alert(AlertDescription::DecodeError, err));

            } else {

                warn!("TLS alert warning received: {:?}", alert);

                return Ok(());

            }

        }



        Err(err)

    }

